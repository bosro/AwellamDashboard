<div class="p-6 max-w-4xl mx-auto">
  <!-- Header -->
  <div class="mb-6">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-semibold text-gray-900">
        {{ isEditMode ? 'Edit Transport Operation' : 'New Transport Operation' }}
      </h1>
      <button routerLink="/transport/trips"
        class="flex items-center px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i class="ri-arrow-left-line mr-2"></i>
        Back to List
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center h-64">
    <i class="ri-loader-4-line text-3xl animate-spin text-blue-600"></i>
  </div>

  <!-- Form -->
  <form [formGroup]="transportForm" (ngSubmit)="onSubmit()" class="space-y-6">
    <!-- Route Information -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-medium mb-4">Route Information</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Start Location
          </label>
          <input type="text" formControlName="startLocation"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" [class.border-red-500]="transportForm.get('startLocation')!.touched && 
                                     transportForm.get('startLocation')!.invalid">
          <div *ngIf="transportForm.get('startLocation')!.touched && 
                        transportForm.get('startLocation')!.invalid" class="mt-1 text-sm text-red-600">
            Start location is required
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            End Location
          </label>
          <input type="text" formControlName="endLocation"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500" [class.border-red-500]="transportForm.get('endLocation')!.touched && 
                                     transportForm.get('endLocation')!.invalid">
        </div>

        <!-- Route Summary -->
        <div class="md:col-span-2 mt-4 p-4 bg-gray-50 rounded-lg">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm font-medium text-gray-600">Estimated Distance</p>
              <p class="text-lg font-semibold">{{estimatedDistance}} km</p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-600">Estimated Duration</p>
              <p class="text-lg font-semibold">{{estimatedDuration}} minutes</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Schedule -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-medium mb-4">Schedule</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Start Time
          </label>
          <input type="datetime-local" formControlName="startTime"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Estimated End Time
          </label>
          <input type="datetime-local" formControlName="estimatedEndTime"
            class="w-full px-4 py-2 bg-gray-50 border rounded-lg" readonly>
        </div>
      </div>
    </div>

    <!-- Resource Assignment -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-medium mb-4">Resource Assignment</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Driver Selection -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Assign Driver
          </label>
          <select formControlName="driverId" (change)="onDriverSelect($event)"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
            <option value="">Select Driver</option>
            <option *ngFor="let driver of availableDrivers" [value]="driver.id">
              {{driver.name}} - Experience: {{driver.experience}} years
            </option>
          </select>
          <div *ngIf="transportForm.get('driverId')?.errors?.['driverUnavailable']" class="mt-1 text-sm text-red-600">
            Selected driver is not available
          </div>
        </div>

        <!-- Truck Selection -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Assign Truck
          </label>
          <select formControlName="truckId" (change)="onTruckSelect($event)"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
            <option value="">Select Truck</option>
            <option *ngFor="let truck of availableTrucks" [value]="truck.id">
              {{truck.registrationNumber}} - Capacity: {{truck.capacity}} tons
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Load Information -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-medium mb-4">Load Information</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Load Capacity (tons)
          </label>
          <input type="number" formControlName="loadCapacity" readonly
            class="w-full px-4 py-2 bg-gray-50 border rounded-lg">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Current Load (tons)
          </label>
          <input type="number" formControlName="currentLoad" [max]="transportForm.get('loadCapacity')!.value"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            [class.border-red-500]="!validateLoad()">
          <div *ngIf="!validateLoad()" class="mt-1 text-sm text-red-600">
            Load exceeds truck capacity
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Notes -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-lg font-medium mb-4">Additional Notes</h2>
      <textarea formControlName="notes" rows="3" placeholder="Enter any additional notes or special instructions..."
        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
    </div>

    <!-- Form Actions -->
    <div class="flex justify-end space-x-4">
      <button type="button" routerLink="/transport/trips" class="px-6 py-2 border rounded-lg hover:bg-gray-50">
        Cancel
      </button>
      <button type="submit" [disabled]="transportForm.invalid || loading || !validateLoad()"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
        <div class="flex items-center">
          <i *ngIf="loading" class="ri-loader-4-line animate-spin mr-2"></i>
          {{ isEditMode ? 'Update' : 'Create' }} Transport
        </div>
      </button>
    </div>
  </form>
</div>
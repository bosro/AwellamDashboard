<div class="p-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-2xl font-semibold text-gray-900">
          Truck Details
        </h1>
        <p class="mt-1 text-sm text-gray-600">{{truck.registrationNumber}} - {{truck.model}}</p>
      </div>
      <div class="flex space-x-3">
        <button 
          [routerLink]="['/transport/trucks']"
          class="flex items-center px-4 py-2 bg-white border rounded-lg hover:bg-gray-50">
          <i class="ri-arrow-left-line mr-2"></i>
          Back to List
        </button>
        <button 
          (click)="scheduleMaintenance()"
          class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          <i class="ri-tools-line mr-2"></i>
          Schedule Maintenance
        </button>
      </div>
    </div>
  
    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center h-64">
      <i class="ri-loader-4-line text-3xl animate-spin text-blue-600"></i>
    </div>
  
    <!-- Truck Details Content -->
    <div *ngIf="!loading && truck" class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Basic Information -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium mb-4">Basic Information</h2>
        <dl class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500">Registration Number</dt>
            <dd class="mt-1">{{truck.registrationNumber}}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Model</dt>
            <dd class="mt-1">{{truck.model}}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Current Location</dt>
            <dd class="mt-1">{{truck.currentLocation}}</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Status</dt>
            <dd class="mt-1">
              <span [class]="'px-2 py-1 rounded-full text-xs font-medium ' + 
                            getStatusClass(truck.status)">
                {{truck.status | titlecase}}
              </span>
            </dd>
          </div>
        </dl>
      </div>
  
      <!-- Performance Metrics -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium mb-4">Performance Metrics</h2>
        <dl class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500">Average Fuel Consumption</dt>
            <dd class="mt-1">{{averageFuelConsumption | number:'1.2-2'}} L/100km</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Total Distance Covered</dt>
            <dd class="mt-1">{{totalDistanceCovered | number:'1.0-0'}} km</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Uptime</dt>
            <dd class="mt-1">{{uptime | number:'1.1-1'}}%</dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Total Maintenance Cost</dt>
            <dd class="mt-1">{{totalMaintenanceCost | currency}}</dd>
          </div>
        </dl>
      </div>
  
      <!-- Maintenance Status -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium mb-4">Maintenance Status</h2>
        <div class="space-y-4">
          <div>
            <p class="text-sm font-medium text-gray-500">Next Scheduled Maintenance</p>
            <p class="mt-1 text-lg font-semibold">
              {{getNextMaintenanceDate() | date:'mediumDate'}}
            </p>
            <p class="text-sm text-gray-500">
              {{getDaysUntilMaintenance()}} days remaining
            </p>
          </div>
          <div class="pt-4 border-t">
            <p class="text-sm font-medium text-gray-500">Last Maintenance</p>
            <p class="mt-1">{{truck.lastMaintenanceDate | date:'mediumDate'}}</p>
            <p class="text-sm text-gray-500">Regular service completed</p>
          </div>
        </div>
      </div>
  
      <!-- Fuel Efficiency Chart -->
      <div class="md:col-span-2 bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-medium">Fuel Efficiency Trend</h2>
          <button 
            (click)="recordFuelRefill()"
            class="flex items-center px-3 py-1 text-sm border rounded-lg hover:bg-gray-50">
            <i class="ri-gas-station-line mr-2"></i>
            Record Refill
          </button>
        </div>
        <div class="h-64">
          <ngx-charts-line-chart
            [results]="fuelEfficiencyTrend"
            [xAxis]="true"
            [yAxis]="true"
            [legend]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="Date"
            yAxisLabel="L/100km">
          </ngx-charts-line-chart>
        </div>
      </div>
  
      <!-- Maintenance Cost Chart -->
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium mb-4">Maintenance Costs</h2>
        <div class="h-64">
          <ngx-charts-bar-vertical
            [results]="maintenanceCostTrend"
            [xAxis]="true"
            [yAxis]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="Month"
            yAxisLabel="Cost">
          </ngx-charts-bar-vertical>
        </div>
      </div>
  
      <!-- Maintenance History -->
      <div class="md:col-span-3 bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-medium">Maintenance History</h2>
          <div class="flex space-x-2">
            <button 
              (click)="exportMaintenanceHistory('excel')"
              class="flex items-center px-3 py-1 text-sm border rounded-lg hover:bg-gray-50">
              <i class="ri-file-excel-line mr-2"></i>
              Export Excel
            </button>
            <button 
              (click)="exportMaintenanceHistory('pdf')"
              class="flex items-center px-3 py-1 text-sm border rounded-lg hover:bg-gray-50">
              <i class="ri-file-pdf-line mr-2"></i>
              Export PDF
            </button>
          </div>
        </div>
  
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Date
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Type
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Description
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Cost
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Technician
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Next Service
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let record of maintenanceHistory">
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.date | date:'mediumDate'}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.type}}
                </td>
                <td class="px-6 py-4">
                  {{record.description}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.cost | currency}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.technicianName}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span [class]="'px-2 py-1 rounded-full text-xs font-medium ' + 
                                getMaintenanceStatusClass(record.status)">
                    {{record.status | titlecase}}
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.nextServiceDate | date:'mediumDate'}}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
  
      <!-- Fuel History -->
      <div class="md:col-span-3 bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-medium">Fuel History</h2>
          <button 
            (click)="recordFuelRefill()"
            class="flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
            <i class="ri-gas-station-line mr-2"></i>
            Record Fuel Refill
          </button>
        </div>
  
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Date
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Quantity (L)
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Cost
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Location
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Odometer
                </th>
                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Fuel Type
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <tr *ngFor="let record of fuelHistory">
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.date | date:'medium'}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.quantity | number:'1.2-2'}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.cost | currency}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.location}}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.odometerReading | number}} km
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {{record.fuelType}}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Fuel Refill Modal -->
  <div *ngIf="showFuelRefillModal" 
       class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium">Record Fuel Refill</h3>
        <button 
          (click)="showFuelRefillModal = false"
          class="text-gray-500 hover:text-gray-700">
          <i class="ri-close-line text-xl"></i>
        </button>
      </div>
  
      <form [formGroup]="fuelRefillForm" (ngSubmit)="submitFuelRefill()">
        <div class="space-y-4">
          <!-- Quantity -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Quantity (Liters)
            </label>
            <input 
              type="number"
              formControlName="quantity"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>
  
          <!-- Cost -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Cost
            </label>
            <input 
              type="number"
              formControlName="cost"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>
  
          <!-- Location -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Location
            </label>
            <input 
              type="text"
              formControlName="location"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>
  
          <!-- Odometer Reading -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Odometer Reading (km)
            </label>
            <input 
              type="number"
              formControlName="odometerReading"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            >
          </div>
  
          <!-- Fuel Type -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Fuel Type
            </label>
            <select 
              formControlName="fuelType"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            >
              <option value="diesel">Diesel</option>
              <option value="petrol">Petrol</option>
              <option value="biodiesel">Biodiesel</option>
            </select>
          </div>
  
          <!-- Form Actions -->
          <div class="flex justify-end space-x-3 pt-4">
            <button 
              type="button"
              (click)="showFuelRefillModal = false"
              class="px-4 py-2 border rounded-lg hover:bg-gray-50">
              Cancel
            </button>
            <button 
              type="submit"
              [disabled]="fuelRefillForm.invalid"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50">
              Record Refill
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
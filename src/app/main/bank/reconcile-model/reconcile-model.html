<div class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
  <div class="bg-white rounded-lg p-6 max-w-md w-full">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Reconcile Transaction</h2>
      <button (click)="onClose()" class="text-gray-500 hover:text-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
             viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Transaction Details -->
    <div class="mb-4">
      <div class="bg-gray-100 p-4 rounded">
        <div class="grid grid-cols-2 gap-2">
          <div>
            <span class="text-gray-600 text-sm">Date:</span>
            <p>{{ transaction.date | date }}</p>
          </div>
          <div>
            <span class="text-gray-600 text-sm">Amount:</span>
            <p [ngClass]="{'text-green-600': transaction.amount > 0, 'text-red-600': transaction.amount < 0}">
              GHC {{ transaction.amount }}
            </p>
          </div>
          <div>
            <span class="text-gray-600 text-sm">Reference:</span>
            <p>{{ transaction.reference }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Error -->
    <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      {{ error }}
    </div>

    <!-- Tabs -->
    <div class="flex border-b mb-4">
      <button (click)="activeTab = 'customers'" 
              [class.border-blue-500]="activeTab === 'customers'"
              class="px-4 py-2 border-b-2 focus:outline-none">
        Customers
      </button>
      <button (click)="activeTab = 'orderType'" 
              [class.border-blue-500]="activeTab === 'orderType'"
              class="px-4 py-2 border-b-2 focus:outline-none">
        Order Type
      </button>
    </div>

    <!-- Customers Tab -->
    <div *ngIf="activeTab === 'customers'">
      <form [formGroup]="reconcileForm" (ngSubmit)="onSubmitCustomer()">
        <div class="mb-4">
          <label for="searchTerm" class="block text-gray-700 mb-2">Search Customer</label>
          <input type="text" id="searchTerm" formControlName="searchTerm"
                 class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                 placeholder="Type to search customers">
          <div *ngIf="searchLoading" class="mt-2 text-sm text-gray-500">Searching...</div>
        </div>

        <div class="mb-4">
          <label for="customerId" class="block text-gray-700 mb-2">Select Customer</label>
          <select id="customerId" formControlName="customerId"
                  class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
            <option value="">-- Select a customer --</option>
            <option *ngFor="let customer of customers" [value]="customer._id">
              {{ customer.fullName }} (Balance: GHC {{ customer.balance }})
            </option>
          </select>
          <div *ngIf="reconcileForm.get('customerId')?.invalid && (reconcileForm.get('customerId')?.dirty || reconcileForm.get('customerId')?.touched)"
               class="text-red-500 mt-1">
            <div *ngIf="reconcileForm.get('customerId')?.errors?.['required']">Please select a customer.</div>
          </div>
        </div>

        <div class="flex justify-end">
          <button type="button" (click)="onClose()"
                  class="px-4 py-2 mr-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded">
            Cancel
          </button>
          <button type="submit" [disabled]="reconcileForm.invalid || loading"
                  class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed">
            <span *ngIf="loading" class="inline-block mr-2">
              <div class="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"></div>
            </span>
            Reconcile
          </button>
        </div>
      </form>
    </div>

    <!-- Order Type Tab -->
    <div *ngIf="activeTab === 'orderType'">
      <form (ngSubmit)="onSubmitOrderType()">
        <div class="mb-4">
          <label for="orderType" class="block text-gray-700 mb-2">Order Type</label>
          <select id="orderType" [(ngModel)]="selectedOrderType" name="orderType"
                  [disabled]="orderTypesLoading"
                  class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500">
            <option value="">-- Select an order type --</option>
            <option *ngFor="let orderType of orderTypes" [value]="orderType._id">
              {{ orderType.name }}
            </option>
          </select>
          <div *ngIf="orderTypesLoading" class="text-sm text-gray-500 mt-2">Loading order types...</div>
        </div>

        <div class="flex justify-end">
          <button type="button" (click)="onClose()"
                  class="px-4 py-2 mr-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded">
            Cancel
          </button>
          <button type="submit"
                  [disabled]="!selectedOrderType || loading || orderTypesLoading"
                  class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed">
            <span *ngIf="loading" class="inline-block mr-2">
              <div class="animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white"></div>
            </span>
            Reconcile
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

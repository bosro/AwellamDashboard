<!-- bank-upload.html -->
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Header with breadcrumbs -->
    <div class="mb-8">
      <nav class="flex" aria-label="Breadcrumb">

          <li>
            <div class="flex items-center">
              <i class="fa fa-chevron-right text-gray-400 mx-1 text-sm"></i>
              <span class="text-gray-700 font-medium">{{ bank?.name }}</span>
            </div>
          </li>

      </nav>
    </div>
  
    <!-- Bank Header -->
    <div class="mb-8">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-1">{{ bank?.name }}</h1>
        </div>

        </div>
      </div>
    </div>
  
    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Upload Section -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 border-b border-blue-600">
            <h2 class="text-xl font-semibold text-white">Upload Statement</h2>
            <p class="text-blue-100 text-sm mt-1">Supported formats: CSV, XLS</p>
          </div>
          
          <div class="p-6">
            <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 mb-4" *ngIf="error">
              <div class="flex">
                <div class="flex-shrink-0">
                  <i class="fa fa-exclamation-circle"></i>
                </div>
                <div class="ml-3">
                  <p class="text-sm">{{ error }}</p>
                </div>
              </div>
            </div>
        
            <div class="mb-6">
              <div 
                class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors" 
                [ngClass]="{'border-blue-500 bg-blue-50': isDragging}"
                (dragover)="onDragOver($event)" 
                (dragleave)="onDragLeave($event)" 
                (drop)="onDrop($event)"
                (click)="fileInput.click()">
                <input #fileInput type="file" class="hidden" (change)="onFileSelected($event)">
                <div class="text-5xl text-gray-400 mb-4">
                  <i class="fa fa-cloud-upload-alt"></i>
                </div>
                <p class="text-gray-600 mb-2">Drag and drop your file here or</p>
                <button class="text-blue-600 font-medium underline">browse files</button>
                <p class="text-gray-500 text-xs mt-2">Maximum file size: 10MB</p>
                
                <div class="mt-4 flex items-center justify-center" *ngIf="selectedFile">
                  <div class="bg-blue-50 rounded-lg p-3 flex items-center max-w-full">
                    <i class="fa fa-file-alt text-blue-500 mr-2"></i>
                    <div class="truncate">
                      <p class="font-medium text-blue-600 text-sm truncate">{{ selectedFile.name }}</p>
                      <p class="text-xs text-gray-500">{{ (selectedFile.size / 1024).toFixed(1) }} KB</p>
                    </div>
                    <button class="ml-2 text-gray-500 hover:text-red-500" (click)="removeSelectedFile($event)">
                      <i class="fa fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
        
            <button 
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded flex items-center justify-center transition-colors disabled:opacity-50 disabled:cursor-not-allowed shadow-md"
              [disabled]="uploadingFile || !selectedFile" 
              (click)="uploadFile()">
              <span *ngIf="uploadingFile" class="mr-2">
                <i class="fa fa-spinner fa-spin"></i>
              </span>
              <span *ngIf="!uploadingFile" class="mr-2">
                <i class="fa fa-upload"></i>
              </span>
              {{ uploadingFile ? 'Uploading...' : 'Upload Statement' }}
            </button>
          </div>
        </div>
        
        <!-- Upload Statistics -->
      
      </div>
  
      <!-- Filter & Upload History Section -->
      <div class="lg:col-span-2">
        <!-- Filter Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-800">Filter Uploads</h2>
            <button 
              class="text-blue-600 hover:text-blue-800 transition-colors text-sm font-medium flex items-center"
              (click)="resetFilters()">
              <i class="fa fa-redo mr-1"></i> Reset All
            </button>
          </div>
  
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
            <div>
              <label for="startDate" class="block text-gray-700 text-sm font-medium mb-2">Start Date</label>
              <div class="relative">
                <input 
                  type="date" 
                  id="startDate" 
                  class="block w-full text-gray-700 border border-gray-300 rounded py-2 pl-3 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                  [(ngModel)]="filters.startDate">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                </div>
              </div>
            </div>
            
            <div>
              <label for="endDate" class="block text-gray-700 text-sm font-medium mb-2">End Date</label>
              <div class="relative">
                <input 
                  type="date" 
                  id="endDate" 
                  class="block w-full text-gray-700 border border-gray-300 rounded py-2 pl-3 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                  [(ngModel)]="filters.endDate">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                  
                </div>
              </div>
            </div>
            
            <div>
              <label for="reference" class="block text-gray-700 text-sm font-medium mb-2">Reference</label>
              <div class="relative">
                <input 
                  type="text" 
                  id="reference" 
                  placeholder="Search by reference"
                  class="block w-full text-gray-700 border border-gray-300 rounded py-2 pl-3 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                  [(ngModel)]="filters.reference">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                  
                </div>
              </div>
            </div>
            
            <div>
              <label for="amount" class="block text-gray-700 text-sm font-medium mb-2">Amount</label>
              <div class="relative">
                <input 
                  type="number" 
                  id="amount" 
                  placeholder="Filter by amount"
                  class="block w-full text-gray-700 border border-gray-300 rounded py-2 pl-3 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                  [(ngModel)]="filters.amount">
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500">
                  
                </div>
              </div>
            </div>
          </div>
          
          <button 
            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded transition-colors flex items-center shadow-sm"
            (click)="applyFilters()">
            <i class="fa fa-filter mr-2"></i> Apply Filters
          </button>
        </div>
  
        <!-- Uploads Table Section -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-800">Uploaded Statements</h2>
            <div class="flex items-center">
              <div *ngIf="loading" class="flex items-center text-blue-600 mr-4">
                <div class="animate-pulse w-2 h-2 bg-blue-600 rounded-full mr-1"></div>
                <div class="animate-pulse w-2 h-2 bg-blue-600 rounded-full mr-1" style="animation-delay: 0.2s"></div>
                <div class="animate-pulse w-2 h-2 bg-blue-600 rounded-full mr-2" style="animation-delay: 0.4s"></div>
                <span>Loading</span>
              </div>
              <div class="bg-blue-50 text-blue-800 text-sm py-1 px-3 rounded-full" *ngIf="uploads.length > 0">
                {{ uploads.length }} statement{{ uploads.length !== 1 ? 's' : '' }}
              </div>
            </div>
          </div>
          
          <div class="overflow-x-auto">
            <table class="min-w-full bg-white" *ngIf="uploads.length > 0">
              <thead>
                <tr class="bg-gray-50 text-gray-500 uppercase text-xs leading-normal border-b border-gray-200">
                  <th class="py-3 px-6 text-left">File Name</th>
                  <th class="py-3 px-6 text-left">Date Uploaded</th>
                  <th class="py-3 px-6 text-left">Status</th>
                  <th class="py-3 px-6 text-center">Actions</th>
                </tr>
              </thead>
              <tbody class="text-gray-600">
                <tr *ngFor="let upload of uploads" class="border-b border-gray-200 hover:bg-gray-50"  [routerLink]="['/main/banks', bankId, 'uploads', upload._id ,{fileName: upload.fileName}]">
                  <td class="py-3 px-6 text-left">
                    <div class="flex items-center">
                      <div class="mr-2">
                        <i class="fa fa-file-alt text-blue-600"></i>
                      </div>
                      <span class="font-medium">{{ upload.fileName }}</span>
                    </div>
                  </td>
                  <td class="py-3 px-6 text-left">{{ upload.createdAt | date:'MMM d, y, h:mm a' }}</td>
                  <td class="py-3 px-6 text-left">
                    <span class="bg-green-100 text-green-800 text-xs font-medium py-1 px-2 rounded-full">
                      Processed
                    </span>
                  </td>
                  <td class="py-3 px-6 text-center">
                    <div class="flex item-center justify-center">
                      <!-- <button class="transform hover:text-blue-600 hover:scale-110 transition-all mr-3 focus:outline-none" 
                              title="View"
                              (click)="viewUpload(upload._id)">
                        <i class="fa fa-eye"></i>
                      </button>
                      <button class="transform hover:text-blue-600 hover:scale-110 transition-all mr-3 focus:outline-none" 
                              title="Download"
                              (click)="downloadUpload(upload._id)">
                        <i class="fa fa-download"></i>
                      </button> -->
                      <button class="transform hover:text-red-600 hover:scale-110 transition-all focus:outline-none" 
                              title="Delete"
                              (click)="deleteUpload(upload._id)">
                        <i class="fa fa-trash-alt"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
    
          <!-- Empty state -->
          <div class="py-16 text-center" *ngIf="uploads.length === 0 && !loading">
            <div class="bg-blue-50 inline-flex p-6 rounded-full mb-4">
              <i class="fa fa-file-upload text-5xl text-blue-400"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-800 mb-2">No statements uploaded yet</h3>
            <p class="text-gray-500 mb-6 max-w-md mx-auto">Upload your first bank statement to start analyzing your financial data</p>
            <button 
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded transition-colors shadow-sm" 
              (click)="scrollToUploadSection()">
              <i class="fa fa-upload mr-2"></i> Upload now
            </button>
          </div>
        </div>
        
        <!-- Pagination -->
        <div class="mt-4 flex flex-col sm:flex-row items-center justify-between" *ngIf="uploads.length > 0">
          <div class="text-sm text-gray-500 mb-3 sm:mb-0">
            Showing <span class="font-medium">1</span> to <span class="font-medium">{{ uploads.length }}</span> of <span class="font-medium">{{ uploads.length }}</span> results
          </div>
          <div class="flex space-x-1">
            <button class="px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 focus:outline-none" [disabled]="currentPage === 1">
              <i class="fa fa-chevron-left text-xs"></i>
            </button>
            <button class="px-3 py-1 rounded bg-blue-600 text-white focus:outline-none">{{ currentPage }}</button>
            <button class="px-3 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 focus:outline-none" [disabled]="currentPage * pageSize >= totalItems">
              <i class="fa fa-chevron-right text-xs"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

  
  <!-- Success notification toast -->
  <div 
    *ngIf="showSuccessToast" 
    class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center transition-all duration-300 ease-in-out"
    [ngClass]="{'opacity-0 translate-y-2': !showSuccessToast, 'opacity-100 translate-y-0': showSuccessToast}">
    <i class="fa fa-check-circle mr-2 text-lg"></i>
    <div>
      <p class="font-medium">Success!</p>
      <p class="text-sm">{{ successMessage }}</p>
    </div>
    <button class="ml-4 text-white opacity-80 hover:opacity-100" (click)="hideSuccessToast()">
      <i class="fa fa-times"></i>
    </button>
  </div>